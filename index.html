<!DOCTYPE html>
<html>
<head>
<title>Battleships</title>
<link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#2d89ef">
<meta name="theme-color" content="#ffffff">
<style>
*, *:before, *:after {
    -webkit-user-select: none; /* Chrome/Safari */        
    -moz-user-select: none; /* Firefox */
    -ms-user-select: none; /* IE10+ */
}

.btn-group .button {
    background: rgb(76, 175, 80); /* Green */
    border: 1px solid green;
    color: white;
    padding: 10px 32px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    cursor: pointer;
    width: 200px;
	height: 40px;
    display: block;
}

.btn-group .button:not(:last-child) {
    border-bottom: none; /* Prevent double borders */
}

.btn-group .button:hover {
    background: rgb(62, 142, 65);
}

.canvas-container{
  position: relative;
  width: 950px;
  height: 550px;
}
#canvas {
  position: absolute;
  background-color:lightgrey
}
#button1 {
  position:absolute;
  left:65%;
  top:47%
}
#button2 {
  position:absolute;
  left:65%;
  top:54%
}
#button3 {
  position:absolute;
  left:65%;
  top:61%
}
#button4 {
  position:absolute;
  left:65%;
  top:68%
}
#button5 {
  position:absolute;
  left:65%;
  top:75%
}
#button6 {
  position:absolute;
  left:65%;
  top:82%
}
#button7 {
  position:absolute;
  left:65%;
  top:89%
}

</style>
</head>
<body>

<div class="canvas-container">
 <canvas id='canvas' width='950px' height='550px'></canvas>
 <div class = "btn-group">
<button class = "button" id="button1" onclick="mode_change('Create'); difficulty = 1;">Level 1 Problem</button>
<button class = "button" id="button2" onclick="mode_change('Solution');">Solution</button>
<button class = "button" id='button3' onclick="mode_change('Guess');" style="background:rgb(76, 175, 80);">Guess Mode</button>
<button class = "button" id="button4" onclick="mode_change('Solver');">Puzzle Solver</button>
<button class = "button" id="button5" onclick="mode_change('Enter');">Enter Problem</button>
<button class = "button" id="button6" onclick="mode_change('Restart');">Restart Problem</button>
<a href="help.html">
<button class = "button" id="button7">Help</button>
</a>
 </div>
</div>

<script>
/*To do
Add notification of correct puzzle
Add difficulty
Ask for beta-testers basically
Phone compatibility?
*/
var canvas = document.getElementById("canvas");
var ctx = canvas.getContext("2d");
ctx.font = "30px Arial";
ctx.fillStyle = "#000000";

function color_change(id){//Change the color of the guess button on click

  var background = document.getElementById(id).style.backgroundColor;

  if(background == "rgb(76, 175, 80)")
  {
  document.getElementById(id).style.backgroundColor = "rgb(62,142,65)";
  }
  if(background == "rgb(62, 142, 65)")
  {
    document.getElementById(id).style.backgroundColor = "rgb(76,175,80)";
  }

}

//Variables for detected ships
var battleship_detected = false; var bx = -1; var by = -1;
var cruiser1_detected = false; var c1x = -1; var c1y = -1;
var cruiser2_detected = false; var c2x = -1; var c2y = -1;
var destroyer1_detected = false; var d1x = -1; var d1y = -1;
var destroyer2_detected = false; var d2x = -1; var d2y = -1;
var destroyer3_detected = false; var d3x = -1; var d3y = -1;
var submarine1_detected = false; var s1x = -1; var s1y = -1;
var submarine2_detected = false; var s2x = -1; var s2y = -1;
var submarine3_detected = false; var s3x = -1; var s3y = -1;
var submarine4_detected = false; var s4x = -1; var s4y = -1;

//Initialize boards
var problem = new Array(10);
var answer = new Array(10);
var work = new Array(10);
var guess = new Array(10);
var row_tot = new Array(10);
var col_tot = new Array(10);
for(var i = 0; i < 10; ++i){
	problem[i] = new Array(10);
	answer[i] = new Array(10);
	work[i] = new Array(10);
	guess[i] = new Array(10);
	row_tot[i] = 0;
	col_tot[i] = 0;
	for(var j = 0; j < 10; ++j){
		problem[i][j] = -1;
		answer[i][j] = 0;
		work[i][j] = -1;
		guess[i][j] = -1;
	}
}

//Initialize mode variables
var solution_shown = false;
var guessing = false;
var entering = false;
var solving = false;
var creating_problem = false;
var difficulty = 1;

//Draw gray side bar
ctx.globalAlpha = 0.2;
ctx.fillStyle="#000000";
ctx.fillRect(600,0,350,550);
ctx.globalAlpha = 1;

function draw_board(){ //Draws the grid and the ships on the side
for(var a = 0; a < 2; ++a){
battleship_detected = false;
cruiser1_detected = false;
cruiser2_detected = false;
destroyer1_detected = false;
destroyer2_detected = false;
destroyer3_detected = false;
submarine1_detected = false;
submarine2_detected = false;
submarine3_detected = false;
submarine4_detected = false;

ctx.clearRect(10,10,550,550);
ctx.rect(10,10,500.5,500.5);
ctx.fill();
for(var i = 0; i < 10; i++){//Reset totals so that they don't re-add together every time its drawn
	row_tot[i] = 0;
	col_tot[i] = 0;
}
	for (var i = 0; i < 10; i++) { //Draw grid
		for(var j = 0; j < 10; j++){
			ctx.beginPath();
			ctx.fillStyle="#FFFFFF";
			ctx.rect(50*i + 11,50*j + 11,48.5,48.5);
			ctx.fill();
			ctx.closePath();
			ctx.fillStyle="#000000";
			if(answer[i][j] > 0){ //Calculate row and column totals
				row_tot[j] = ++row_tot[j];
			}
			if(answer[j][i] > 0){
				col_tot[j] = ++col_tot[j];
			}
		}
	}

	for(var i = 0; i < 10; i++){//display totals
		ctx.fillText(row_tot[i],525,50*i+50);
		ctx.fillText(col_tot[i],50*i + 25,540);
	}

for(var i = 0; i < 10; ++i){ //Detect complete ships
	for(var j = 0; j < 10; ++j){
		if(work[i][j] === 6 || problem[i][j] === 6){ //Submarine detection
			if(submarine1_detected && !(s1x === i && s1y === j)){
				if(submarine2_detected && !(s2x === i && s2y === j) && !(s1x === i && s1y === j)){
					if(submarine3_detected && !(s3x === i && s3y === j) && !(s2x === i && s2y === j) && !(s1x === i && s1y === j)){
						if(!submarine4_detected){
							submarine4_detected = true;
						}
					}
					else if(!submarine3_detected){
						submarine3_detected = true;
						s3x = i;
						s3y = j;
					}
				}
				else if(!submarine2_detected){
					submarine2_detected = true;
					s2x = i;
					s2y = j;
				}
			}
			else if(!submarine1_detected){
				submarine1_detected = true;
				s1x = i;
				s1y = j;
			}
		}
		if(work[i][j] === 4 || problem[i][j] === 4){
			if(work[i][j+1] === 2 || problem[i][j+1] === 2){//Destroyer detection
				if(destroyer1_detected && !(d1x === i && d1y === j)){
					if(destroyer2_detected && !(d2x === i && d2y === j) && !(d1x === i && d1y === j)){
						if(!destroyer3_detected){
							destroyer3_detected = true;
						}
					}
					else if(!destroyer2_detected){
						destroyer2_detected = true;
						d2x = i;
						d2y = j;
					}
				}
				else if(!destroyer1_detected){
					destroyer1_detected = true;
					d1x = i;
					d1y = j;
				}
			}
			if(work[i][j+1] === 5 || problem[i][j+1] === 5){
				if(work[i][j+2] === 2 || problem[i][j+2] === 2){ //Cruiser detection
					if(cruiser1_detected && !(c1x === i && c1y === j)){
						if(!cruiser2_detected){
							cruiser2_detected = true;
						}
					}
					else if(!cruiser1_detected){
						cruiser1_detected = true;
						c1x = i;
						c1y = j;
					}
				}
				if(work[i][j+2] === 5 || problem[i][j+2] === 5){ //Battleship detection
					if(work[i][j+3] === 2 || problem[i][j+3] === 2){
						if(!battleship_detected){
							battleship_detected = true;
						}
					}
				}
			}
		}
		if(work[i][j] === 1 || problem[i][j] === 1){
			if(work[i+1][j] === 3 || problem[i+1][j] === 3){ //Destroyer detection
				if(destroyer1_detected && !(d1x === i && d1y === j)){
					if(destroyer2_detected && !(d2x === i && d2y === j) && !(d1x === i && d1y === j)){
						if(!destroyer3_detected){
							destroyer3_detected = true;
						}
					}
					else if(!destroyer2_detected){
						destroyer2_detected = true;
						d2x = i;
						d2y = j;
					}
				}
				else if(!destroyer1_detected){
					destroyer1_detected = true;
					d1x = i;
					d1y = j;
				}
			}
			if(work[i+1][j] === 5 || problem[i+1][j] === 5){
				if(work[i+2][j] === 3 || problem[i+2][j] === 3){  //Cruiser detection
					if(cruiser1_detected && !(c1x === i && c1y === j)){
						if(!cruiser2_detected){
							cruiser2_detected = true;
							c2x = i;
							c2y = j;
						}
					}
					else if(!cruiser1_detected){
						cruiser1_detected = true;
						c1x = i;
						c1y = j;
					}
				}
				if(work[i+2][j] === 5 || problem[i+2][j] === 5){ //Battleship detection
					if(work[i+3][j] === 3 || problem[i+3][j] === 5){
						if(!battleship_detected){
							battleship_detected = true;
							bx = i;
							by = j;
						}
					}
				}
			}
		}
	}
}
//Shade ships grey if detected
//Sub1
if(submarine1_detected){
ctx.fillStyle="#555555";
}
else{
ctx.fillStyle="#000000";
}
ctx.beginPath();
ctx.arc((12+1)*50 - 15,(1)*50 - 15,20,0,2*Math.PI,false);
ctx.fill();

if(submarine2_detected){
ctx.fillStyle="#555555";
}
else{
ctx.fillStyle="#000000";
}
//Sub2
ctx.beginPath();
ctx.arc((13+1)*50 - 15,(1)*50 - 15,20,0,2*Math.PI,false);
ctx.fill();

if(submarine3_detected){
ctx.fillStyle="#555555";
}
else{
ctx.fillStyle="#000000";
}
//Sub3
ctx.beginPath();
ctx.arc((14+1)*50 - 15,(1)*50 - 15,20,0,2*Math.PI,false);
ctx.fill();

if(submarine4_detected){
ctx.fillStyle="#555555";
}
else{
ctx.fillStyle="#000000";
}
//Sub4
ctx.beginPath();
ctx.arc((15+1)*50 - 15,(1)*50 - 15,20,0,2*Math.PI,false);
ctx.fill();

//Destroyer1
if(destroyer1_detected){
ctx.fillStyle="#555555";
}
else{
ctx.fillStyle="#000000";
}
ctx.fillRect(50*(12+1)-15,(1+1)*50-35,20,40);
ctx.beginPath();
ctx.arc((12+1)*50 - 15,(1+1)*50 - 15,20,0,2*Math.PI,false);
ctx.fill();
ctx.fillRect(50*(13+1)-35,(1+1)*50-35,20,40);
ctx.beginPath();
ctx.arc((13+1)*50 - 15,(1+1)*50 - 15,20,0,2*Math.PI,false);
ctx.fill();

//Destroyer2
if(destroyer2_detected){
ctx.fillStyle="#555555";
}
else{
ctx.fillStyle="#000000";
}
ctx.fillRect(50*(14+1)-15,(1+1)*50-35,20,40);
ctx.beginPath();
ctx.arc((14+1)*50 - 15,(1+1)*50 - 15,20,0,2*Math.PI,false);
ctx.fill();
ctx.fillRect(50*(15+1)-35,(1+1)*50-35,20,40);
ctx.beginPath();
ctx.arc((15+1)*50 - 15,(1+1)*50 - 15,20,0,2*Math.PI,false);
ctx.fill();

//Destroyer3
if(destroyer3_detected){
ctx.fillStyle="#555555";
}
else{
ctx.fillStyle="#000000";
}
ctx.fillRect(50*(16+1)-15,(1+1)*50-35,20,40);
ctx.beginPath();
ctx.arc((16+1)*50 - 15,(1+1)*50 - 15,20,0,2*Math.PI,false);
ctx.fill();
ctx.fillRect(50*(17+1)-35,(1+1)*50-35,20,40);
ctx.beginPath();
ctx.arc((17+1)*50 - 15,(1+1)*50 - 15,20,0,2*Math.PI,false);
ctx.fill();

//Cruiser1
if(cruiser1_detected){
ctx.fillStyle="#555555";
}
else{
ctx.fillStyle="#000000";
}
ctx.fillRect(50*(12+1)-15,(2+1)*50-35,20,40);
ctx.beginPath();
ctx.arc((12+1)*50 - 15,(2+1)*50 - 15,20,0,2*Math.PI,false);
ctx.fill();
ctx.fillRect(50*(13+1)-35,(2+1)*50-35,40,40);
ctx.fillRect(50*(14+1)-35,(2+1)*50-35,20,40);
ctx.beginPath();
ctx.arc((14+1)*50 - 15,(2+1)*50 - 15,20,0,2*Math.PI,false);
ctx.fill();

//Cruiser 2
if(cruiser2_detected){
ctx.fillStyle="#555555";
}
else{
ctx.fillStyle="#000000";
}
ctx.fillRect(50*(15+1)-15,(2+1)*50-35,20,40);
ctx.beginPath();
ctx.arc((15+1)*50 - 15,(2+1)*50 - 15,20,0,2*Math.PI,false);
ctx.fill();	
ctx.fillRect(50*(16+1)-35,(2+1)*50-35,40,40);
ctx.fillRect(50*(17+1)-35,(2+1)*50-35,20,40);
ctx.beginPath();
ctx.arc((17+1)*50 - 15,(2+1)*50 - 15,20,0,2*Math.PI,false);
ctx.fill();

//Battleship
if(battleship_detected){
ctx.fillStyle="#555555";
}
else{
ctx.fillStyle="#000000";
}
ctx.fillRect(50*(12+1)-15,(3+1)*50-35,20,40);
ctx.beginPath();
ctx.arc((12+1)*50 - 15,(3+1)*50 - 15,20,0,2*Math.PI,false);
ctx.fill();	
ctx.fillRect(50*(13+1)-35,(3+1)*50-35,40,40);
ctx.fillRect(50*(14+1)-35,(3+1)*50-35,40,40);
ctx.fillRect(50*(15+1)-35,(3+1)*50-35,20,40);
ctx.beginPath();
ctx.arc((15+1)*50 - 15,(3+1)*50 - 15,20,0,2*Math.PI,false);
ctx.fill();

ctx.fillStyle="#000000";
}	
}

function check(row,col,dir,size){ //When creating a board checks surrounding spaces of ship
	for(var i = 0; i < 3; i++){
		for(var j = 0; j < 3; j++){
			if(((row - 1 + i) >= 0) && ((col - 1 + j) >= 0) && ((row - 1 + i) <= 9) & ((col - 1 + j) <= 9)) { //check if current cell is out of bounds
				if(answer[row - 1 + i][col - 1 + j] > 0) { //check cell for ship
					return 0;
				}
			}
		}
	}
	//Move to next cell
	if (dir === 0) {
		row = row - size + 1;
	}
	else if(dir === 1) {
		col = col + size - 1;
	}
	else if(dir === 2) {
		row = row + size - 1;
	}
	else if(dir === 3) {
		col = col - size + 1;
	}
	//Check next cell
	for(var i = 0; i < 3; i++){
		for(var j = 0; j < 3; j++){
			if(((row - 1 + i) >= 0) && ((col - 1 + j) >= 0) && ((row - 1 + i) <= 9) & ((col - 1 + j) <= 9)) { //check if current cell is out of bounds
				if(answer[row - 1 + i][col - 1 + j] > 0) { //check cell for ship
					return 0;
				}
			}
		}
	}
	return 1;
}

function create(){ //Create random legal board
	var row = Math.floor(Math.random()*10);
	var col = Math.floor(Math.random()*10);
	var dir = Math.floor(Math.random()*4);
	
	//Create Battleship
	var repeat = true;
	while(repeat){
		dir = Math.floor(Math.random()*4);
		if((dir === 0) && (row > 2)){//up
			answer[row][col] = 3;
			answer[row - 1][col] = 5;
			answer[row - 2][col] = 5;
			answer[row - 3][col] = 1;
			repeat = false;
		}
		else if((dir === 1) && (col < 7)){//right
			answer[row][col] = 4;
			answer[row][col + 1] = 5;
			answer[row][col + 2] = 5;
			answer[row][col + 3] = 2;
			repeat = false;
		}
		else if((dir === 2) && (row < 7)){//down
			answer[row][col] = 1;
			answer[row + 1][col] = 5;
			answer[row + 2][col] = 5;
			answer[row + 3][col] = 3;
			repeat = false;
		}
		else if((dir === 3) && (col > 2)){//left
			answer[row][col] = 2;
			answer[row][col - 1] = 5;
			answer[row][col - 2] = 5;
			answer[row][col - 3] = 4;
			repeat = false;
		}
	}
	
	//Create Cruisers
	for(var ship=0; ship < 2; ship++){
		repeat = true;
		while(repeat){
			row = Math.floor(Math.random()*10);
			col = Math.floor(Math.random()*10);
			dir = Math.floor(Math.random()*4);
			if((dir === 0) && (row > 1) && check(row,col,dir,3)){//up
				answer[row][col] = 3;
				answer[row - 1][col] = 5;
				answer[row - 2][col] = 1;
				repeat = false;
			}
			else if((dir === 1) && (col < 8) && check(row,col,dir,3)){//right
				answer[row][col] = 4;
				answer[row][col + 1] = 5;
				answer[row][col + 2] = 2;
				repeat = false;
			}
			else if((dir === 2) && (row < 8) && check(row,col,dir,3)){//down
				answer[row][col] = 1;
				answer[row + 1][col] = 5;
				answer[row + 2][col] = 3;
				repeat = false;
			}
			else if((dir === 3) && (col > 1) && check(row,col,dir,3)){//left
				answer[row][col] = 2;
				answer[row][col - 1] = 5;
				answer[row][col - 2] = 4;
				repeat = false;
			}
		}
	}
	
	//Create Destroyers
	for(var ship=0; ship < 3; ship++){
		repeat = true;
		while(repeat){
			row = Math.floor(Math.random()*10);
			col = Math.floor(Math.random()*10);
			dir = Math.floor(Math.random()*4);
			if((dir === 0) && (row > 1) && check(row,col,dir,2)){//up
				answer[row][col] = 3;
				answer[row - 1][col] = 1;
				repeat = false;
			}
			else if((dir === 1) && (col < 8) && check(row,col,dir,2)){//right
				answer[row][col] = 4;
				answer[row][col + 1] = 2;
				repeat = false;
			}
			else if((dir === 2) && (row < 8) && check(row,col,dir,2)){//down
				answer[row][col] = 1;
				answer[row + 1][col] = 3;
				repeat = false;
			}
			else if((dir === 3) && (col > 1) && check(row,col,dir,2)){//left
				answer[row][col] = 2;
				answer[row][col - 1] = 4;
				repeat = false;
			}
		}
	}
	
	//Create Submarines
	for(var ship = 0; ship < 4; ship++){
		repeat = true;
		while(repeat){
			row = Math.floor(Math.random()*10);
			col = Math.floor(Math.random()*10);
			if(check(row,col,1,1)){
				answer[row][col] = 6;
				repeat = false;
			}
		}
	}
}

function decode_display(data,row,col){ //Displays the board based on the ship array
switch(data){
		case 0: //water
			ctx.fillText("~~~",50*(row+1) - 40,50*(col+1) - 20);
			ctx.fillText("~~~",50*(row+1) - 40,50*(col+1) - 5);
			ctx.fillText("~~~",50*(row+1) - 40,50*(col+1) + 10);
		break;
		case 1: //left end
			ctx.fillRect(50*(row+1)-15,(col+1)*50-35,20,40);
			ctx.beginPath();
			ctx.arc((row+1)*50 - 15,(col+1)*50 - 15,20,0,2*Math.PI,false);
			ctx.fill();
		break;
		case 2: //down end
			ctx.fillRect(50*(row+1)-35,(col+1)*50-35,40,20);
			ctx.beginPath();
			ctx.arc((row+1)*50 - 15,(col+1)*50 - 15,20,0,2*Math.PI,false);
			ctx.fill();
		break;
		case 3: //right end
			ctx.fillRect(50*(row+1)-35,(col+1)*50-35,20,40);
			ctx.beginPath();
			ctx.arc((row+1)*50 - 15,(col+1)*50 - 15,20,0,2*Math.PI,false);
			ctx.fill();
		break;
		case 4://up end
			ctx.fillRect(50*(row+1)-35,(col+1)*50-15,40,20);
			ctx.beginPath();
			ctx.arc((row+1)*50 - 15,(col+1)*50 - 15,20,0,2*Math.PI,false);
			ctx.fill();
		break;
		case 5://center
			ctx.fillRect(50*(row+1)-35,(col+1)*50-35,40,40);
		break;
		case 6://submarine
			ctx.beginPath();
			ctx.arc((row+1)*50 - 15,(col+1)*50 - 15,20,0,2*Math.PI,false);
			ctx.fill();
		break;
		case 7://hint
			decode_display(problem[row][col],row,col); //case for hints
		break;
		case 8://unknown ship
			ctx.beginPath();
			ctx.arc((row+1)*50 - 15,(col+1)*50 - 15,10,0,2*Math.PI,false);
			ctx.fill();
		break;
	}
}

function display_answer(){ //display the answer of the board
draw_board();
var perfect = true;
	for (var i = 0; i < 10; i++){
		for(var j = 0; j < 10; j++){
		decode_display(answer[i][j],i,j);
		if(answer[i][j] !== work[i][j] && work[i][j] !== 7){//Check for mistakes
			ctx.globalAlpha = 0.2;
			ctx.fillStyle="#FF0000";
			ctx.fillRect(50*i + 11,50*j + 11,48.5,48.5);
			ctx.globalAlpha = 1;
			ctx.fillStyle="#000000";
			perfect = false;
		}
		}
	}
if(perfect){
	alert("Correct!");
}
}

function enter_problem(x,y){ //User entered board
if(x > -1 && y > -1){
	if(x < 10 && y < 10){ //Update board
		if(work[x][y] < 6){
			++work[x][y];
		}
		else{
			work[x][y] = -1;
		}
	}
	else if (x === 10 && y < 10){//Update row totals
		if(row_tot[y] < 8){
			++row_tot[y];
		}
		else{
			row_tot[y] = 0;
		}
	}
	else if (y === 10 && x < 10){//Update col totals
		if(col_tot[x] < 8){
			++col_tot[x];
		}
		else{
			col_tot[x] = 0;
		}
	}
}
ctx.clearRect(10,10,550,550);
ctx.rect(10,10,500.5,500.5);
ctx.fill();
for (var i = 0; i < 10; i++) { //Draw grid
		for(var j = 0; j < 10; j++){
			ctx.beginPath();
			ctx.fillStyle="#FFFFFF";
			ctx.rect(50*i + 11,50*j + 11,48.5,48.5);
			ctx.fill();
			ctx.closePath();
			ctx.fillStyle="#000000";
		}
	}
	for(var i = 0; i < 10; ++i){
		ctx.fillText(row_tot[i],525,50*i+50);
		ctx.fillText(col_tot[i],50*i + 25,540);
		for(var j = 0; j < 10; ++j){
			decode_display(work[i][j],i,j);
		}
	}
}

//Variables for interactivity
var mouse_down = false;
var dragging = false;
var mouse_up = true;
var drag_value = 9;

function getMousePos(canvas, evt) { //Get Mouse grid coordinates
  var rect = canvas.getBoundingClientRect();
  return {
    x: Math.floor((evt.clientX - rect.left - 10)/50),
    y: Math.floor((evt.clientY - rect.top - 10)/50)
  };
}

function decode_work(row,col){ //Update the work screen to match expected ship piece
	var up = 0;
	var right = 0;
	var down = 0;
	var left = 0;
	if(row !== 0){
		up = work[row - 1][col];
		if(up === 7){
			up = problem[row - 1][col];
		}
	}
	if(row !== 9){
		down = work[row + 1][col];
		if(down === 7){
			down = problem[row + 1][col];
		}
	}
	if(col !== 0){
		left = work[row][col - 1];
		if(left === 7){
			left = problem[row][col - 1];
		}
	}
	if(col !== 9){
		right = work[row][col + 1];
		if(right === 7){
			right = problem[row][col + 1];
		}
	}
	//Begin decode
	if(work[row][col] === 7){
	return 0;
	}
	if(!(up||down||left||right)){ //surrounded by water turn into a submarine
		work[row][col] = 6;
	}
	else if((up === 1 || up === 5 || up === 8) && (down === 5 || down === 3 || down === 8) || (right === 2 || right === 5 || right === 8) && (left === 4 || left === 5 || left === 8)){ //if next to ships turn into ship middle
		work[row][col] = 5;
	}
	//ship ends
	else if((up === 5 || up === 1 || up === 8)&& !down){
		work[row][col] = 3;
	}
	else if((down === 5 || down === 3 || down === 8)&& !up){
		work[row][col] = 1;
	}
	else if((left === 5 || left === 4 || left === 8)&& !right){
		work[row][col] = 2;
	}
	else if((right === 5 || right === 2 || right === 8)&& !left){
		work[row][col] = 4;
	}
	else {
		work[row][col] = 8;
	}
	
}

function update_display(x,y){//Update the view of the board
	if(x > -1 && x < 10 && y > -1 && y < 10 && work[x][y] !== 7 && !solution_shown){
		if(dragging){//Dragging mode
			if(drag_value === 9){
				if(work[x][y] === -1){
					drag_value = 0;
				}
				else if(work[x][y] === 0){
					drag_value = 8;
				}
				work[x][y] = drag_value;
			}
			if(work[x][y] === -1){
				work[x][y] = drag_value;
			}
		}
		else{//Click mode
			if(!guessing){
				if(work[x][y] === -1){
					work[x][y] = 0;
				}
				else if(work[x][y] === 0){
					work[x][y] = 8;
				}
				else{
					work[x][y] = -1;
				}
			}
			if(guessing){
				if(guess[x][y] === -1){
					guess[x][y] = 0;
				}
				else if(guess[x][y] === 0){
					guess[x][y] = 8;
				}
				else{
					guess[x][y] = -1;
				}
			}
		}
		draw_board();
		for(var i = 0; i < 10; ++i){
			for(var j = 0; j < 10; ++j){
				if(work[i][j] === -1){
					if(guess[i][j] === 0){
						ctx.fillText("~",50*(i+1) - 40,50*(j+1) - 20);
					}
					else if(guess[i][j] === 8){
						ctx.beginPath();
						ctx.arc(i*50 + 20,j*50 + 20,5,0,2*Math.PI,false);
						ctx.fill();
					}
				}
				else{
					guess[i][j] = -1;
				}
				if(work[i][j] > 0){
					decode_work(i,j);
				}
			}
		}
		for(var i = 0; i < 10; ++i){
			for(var j = 0; j < 10; ++j){
				if(work[i][j] > 0){
					decode_work(i,j);
				}
				decode_display(work[i][j],i,j);
			}
		}
	}
}

canvas.addEventListener('mousemove', function(evt1){ //When moved
var mousePos = getMousePos(canvas, evt1);
if(mouse_down && !mouse_up && !guessing && !entering && !solving){
	dragging = true;
	update_display(mousePos.x,mousePos.y);
}
});

document.addEventListener('mouseup', function(evt2){ //When mouse is released
var mousePos = getMousePos(canvas, evt2);
mouse_down = false;
mouse_up = true;
drag_value = 9;
if(entering && !dragging && !solving){
enter_problem(mousePos.x,mousePos.y);
}
else if(!dragging && !solving){
update_display(mousePos.x,mousePos.y);
}
dragging = false;
});

document.addEventListener('mousedown', function(){ //When mouse is pressed down
mouse_down = true;
mouse_up = false;
});

function problem_solver(difficulty){
	var current_row_tot = new Array(10);
	var current_col_tot = new Array(10);
	var empty_row_tot = new Array(10);
	var empty_col_tot = new Array(10);
	var iterations = 10;
	for(var a = 0; a < iterations; ++a){
	for(var i = 0; i < 10; ++i){
		current_row_tot[i] = 0;
		current_col_tot[i] = 0;
		empty_row_tot[i] = 0;
		empty_col_tot[i] = 0;
		for(var j = 0; j < 10; ++j){
			if(work[i][j] === 7){
				work[i][j] = problem[i][j];
			}
		}
	}
	for(var i = 0; i < 10; ++i){
		for(var j = 0; j < 10; ++j){
			if(work[i][j] === 7){
				work[i][j] = problem[i][j];
			}
			if(work[j][i] > 0){
				++current_col_tot[j];
			}
			if(work[i][j] > 0){
				++current_row_tot[j];
			}
			if(work[j][i] !== 0){
				++empty_col_tot[j];
				}
			if(work[i][j] !== 0){
				++empty_row_tot[j];
			}
		}
	}
	for(var i = 0; i < 10; ++i){
			if(current_row_tot[i] === row_tot[i]){ //fill row with water if the current ship parts = row number
				for(var j = 0; j < 10; ++j){
					if(work[j][i] === -1){
						work[j][i] = 0;
					}
				}
			}
			if(current_col_tot[i] === col_tot[i]){ //fill col with water if the current ship parts = col number
				for(var j = 0; j < 10; ++j){
					if(work[i][j] === -1){
						work[i][j] = 0;
					}
				}
			}
			if(empty_row_tot[i] === row_tot[i]){ //fill row with ships if count is right
				for(var j = 0; j < 10; ++j){
					if(work[j][i] === -1){
						work[j][i] = 8;
					}
				}
			}
			if(empty_col_tot[i] === col_tot[i]){ //fill col with ships if count is right
				for(var j = 0; j < 10; ++j){
					if(work[i][j] === -1){
						work[i][j] = 8;
					}
				}
			}
			for(var j = 0; j < 10; ++j){
			if(work[i][j] === 6){ //surround submarines with water
				if(i > 0){
					work[i-1][j] = 0;
					if(j > 0){
						work[i-1][j-1] = 0;
					}
				}
				if(j > 0){
					work[i][j-1] = 0;
					if(i < 9){
						work[i+1][j-1] = 0;
					}
				}
				if(i < 9){
					work[i+1][j] = 0;
					if(j < 9){
						work[i+1][j+1] = 0;
					}
				}
				if(j < 9){
					work[i][j+1] = 0;
					if(i > 0){
						work[i-1][j+1] = 0;
					}
				}
			}
			if(work[i][j] === 1){ //surround left end with water
				if(i > 0){
					work[i-1][j] = 0;
					if(j > 0){
						work[i-1][j-1] = 0;
					}
				}
				if(j > 0){
					work[i][j-1] = 0;
					if(i < 9){
						work[i+1][j-1] = 0;
					}
				}
				if(i < 9){
				if(work[i+1][j] === -1){
					work[i+1][j] = 8;
					}
					if(j < 9){
						work[i+1][j+1] = 0;
					}
				}
				if(j < 9){
					work[i][j+1] = 0;
					if(i > 0){
						work[i-1][j+1] = 0;
					}
				}
			}
			if(work[i][j] === 2){ //surround down end with water
				if(i > 0){
					work[i-1][j] = 0;
					if(j > 0){
						work[i-1][j-1] = 0;
					}
				}
				if(j > 0){
				if(work[i][j-1] === -1){
					work[i][j-1] = 8;
					}
					if(i < 9){
						work[i+1][j-1] = 0;
					}
				}
				if(i < 9){
					work[i+1][j] = 0;
					if(j < 9){
						work[i+1][j+1] = 0;
					}
				}
				if(j < 9){
					work[i][j+1] = 0;
					if(i > 0){
						work[i-1][j+1] = 0;
					}
				}
			}
			if(work[i][j] === 3){ //surround right end with water
				if(i > 0){
				if(work[i-1][j] === -1){
					work[i-1][j] = 8;
					}
					if(j > 0){
						work[i-1][j-1] = 0;
					}
				}
				if(j > 0){
					work[i][j-1] = 0;
					if(i < 9){
						work[i+1][j-1] = 0;
					}
				}
				if(i < 9){
					work[i+1][j] = 0;
					if(j < 9){
						work[i+1][j+1] = 0;
					}
				}
				if(j < 9){
					work[i][j+1] = 0;
					if(i > 0){
						work[i-1][j+1] = 0;
					}
				}
			}
			if(work[i][j] === 4){ //surround up end with water
				if(i > 0){
					work[i-1][j] = 0;
					if(j > 0){
						work[i-1][j-1] = 0;
					}
				}
				if(j > 0){
					work[i][j-1] = 0;
					if(i < 9){
						work[i+1][j-1] = 0;
					}
				}
				if(i < 9){
					work[i+1][j] = 0;
					if(j < 9){
						work[i+1][j+1] = 0;
					}
				}
				if(j < 9){
				if(work[i][j+1] === -1){
					work[i][j+1] = 8;
					}
					if(i > 0){
						work[i-1][j+1] = 0;
					}
				}
			}
			if(work[i][j] === 5 || work[i][j] === 8){ //surround center with water
				if(i > 0){
					if(j > 0){
						work[i-1][j-1] = 0;
					}
				}
				if(j > 0){
					if(i < 9){
						work[i+1][j-1] = 0;
					}
				}
				if(i < 9){
					if(j < 9){
						work[i+1][j+1] = 0;
					}
				}
				if(j < 9){
					if(i > 0){
						work[i-1][j+1] = 0;
					}
				}
			}
			if(work[i][j] === 5){ //add knowable ships around centers
				if((i > 0)&&(j > 0)&&(i < 9)&&(j < 9)){
					if(work[i+1][j] === 0 || work[i-1][j] === 0){
						if(work[i][j-1] === -1){
							work[i][j-1] = 8;
						}
						if(work[i][j+1] === -1){
							work[i][j+1] = 8;
						}
					}
					if(work[i][j+1] === 0 || work[i][j-1] === 0){
						if(work[i-1][j] === -1){
							work[i-1][j] = 8;
						}
						if(work[i+1][j] === -1){
							work[i+1][j] = 8;
						}
					}
				}
				if(i === 0 || i === 9){
					if(j < 9){
						if(work[i][j+1] === -1){
							work[i][j+1] = 8;
						}
					}
					if(j > 0){
						if(work[i][j-1] === -1){
							work[i][j-1] = 8;
						}
					}
				}
				if(j === 0 || j === 9){
					if(i < 9){
						if(work[i+1][j] === -1){
							work[i+1][j] = 8;
						}
					}
					if(i > 0){
						if(work[i-1][j] === -1){
							work[i-1][j] = 8;
						}
					}
				}
			}
			//*******end of level 1 difficulty*************//
			if(difficulty > 1){//add harder logic here by puzzle
			
			}
			if(work[i][j] === 8){
					decode_work(i,j);
				}
			}
		}
	}
	if(!creating_problem){
		ctx.clearRect(10,10,550,550);
		ctx.rect(10,10,500.5,500.5);
		ctx.fill();
		for (var i = 0; i < 10; i++) { //Draw grid
			for(var j = 0; j < 10; j++){
				ctx.beginPath();
				ctx.fillStyle="#FFFFFF";
				ctx.rect(50*i + 11,50*j + 11,48.5,48.5);
			 	ctx.fill();
				ctx.closePath();
				ctx.fillStyle="#000000";
			}
		}
		for(var i = 0; i < 10; ++i){
			ctx.fillText(row_tot[i],525,50*i+50);
			ctx.fillText(col_tot[i],50*i + 25,540);
			for(var j = 0; j < 10; ++j){
				decode_display(work[i][j],i,j);
			}
		}
	}
}

var coordinates = new Array(100); //Create array with numbers 00-99
var x_coor = new Array(100);
var y_coor = new Array(100);
for(var i = 0; i < 100; ++i){
	coordinates[i] = i;
}

function problem_creater(difficulty){ //Creates solvable problems
	for(var i = 0; i < 10; ++i){ //Clear current answer
		row_tot[i] = 0;
		col_tot[i] = 0;
		for(var j = 0; j < 10; ++j){
			answer[i][j] = 0;
			problem[i][j] = -1;
		}
	}
	create(); //Create new board
	for(var i = 0; i < 10; ++i){ //Initialize work board to answer board
		for(var j = 0; j < 10; ++j){
			work[i][j] = answer[i][j];
			problem[i][j] = answer[i][j];
			if(answer[i][j] > 0){ //Calculate row and column totals
					row_tot[j] = ++row_tot[j];
				}
			if(answer[j][i] > 0){
				col_tot[j] = ++col_tot[j];
			}
		}
	}
	//Randomly sort coordinates
	for (var i = coordinates.length - 1; i > 0; i--) {
        var j = Math.floor(Math.random() * (i + 1));
        var temp = coordinates[i];
        coordinates[i] = coordinates[j];
        coordinates[j] = temp;
    }
	for(var i = 0; i < 100; ++i){
		x_coor[i] = Math.floor(coordinates[i]/10);
		y_coor[i] = coordinates[i] - x_coor[i]*10;
	}
	
	for(var c = 0; c < 100; ++c){ //Removes each coordinate and checks if solvable
	for (var i = 0; i < 10; i++) { //Draw grid
		for(var j = 0; j < 10; j++){
				work[i][j] = problem[i][j];
		}
	}
	work[x_coor[c]][y_coor[c]] = -1;
	problem_solver();
	var match = true;
		for (var i = 0; i < 10; i++) {
			for(var j = 0; j < 10; j++){
				if(work[i][j] !== answer[i][j]){ //If problem isn't solvable, replace removed piece
					match = false;
				}
			}
		}
		if(match){
			problem[x_coor[c]][y_coor[c]] = -1;
		}
	}
	
		//Display problem
		ctx.clearRect(10,10,550,550);
		ctx.rect(10,10,500.5,500.5);
		ctx.fill();
		for (var i = 0; i < 10; i++) { //Draw grid
			for(var j = 0; j < 10; j++){
				ctx.beginPath();
				ctx.fillStyle="#FFFFFF";
				ctx.rect(50*i + 11,50*j + 11,48.5,48.5);
			 	ctx.fill();
				ctx.closePath();
				ctx.fillStyle="#000000";
			}
		}
		for(var i = 0; i < 10; ++i){
			ctx.fillText(row_tot[i],525,50*i+50);
			ctx.fillText(col_tot[i],50*i + 25,540);
			for(var j = 0; j < 10; ++j){
				work[i][j] = problem[i][j];
				if(work[i][j] > 0){
					work[i][j] = 7;
				}
				decode_display(work[i][j],i,j);
			}
		}
}

draw_board(); //Start display with a level 1 problem
problem_creater(difficulty);

function mode_change(mode){ //Compartmentalizes different modes
	switch(mode){
		case 'Create': //Generates an easy to solve problem
		creating_problem = true;
		solution_shown = false;
		entering = false;
		solving = false;
		if(guessing){
			guessing = false;
			color_change('button3');
		}
		problem_creater(difficulty);
		break;
		
		case 'Solution': //Shows the solution and mistakes
		if(!solution_shown && !entering){
			if(guessing){
				guessing = false;
				color_change('button3');
			}
			creating_problem = false;
			solving = false;
			display_answer();
			solution_shown = true;
		}
		break;
		
		case 'Solver': //Solves the problem as far as possible using the programmed logic
		if(!solution_shown){
			if(guessing){
				guessing = false;
				color_change('button3');
			}
			entering = false;
			solving = true;
			creating_problem = false;
			problem_solver(6);
		}
		break;
		
		case 'Enter': //Allows user to enter their own problems
		solution_shown = false;
		creating_problem = false;
		solving = false;
		if(guessing){
			guessing = false;
			color_change('button3');
		}
		entering = true;
		ctx.clearRect(10,10,550,550);
		for(var i = 0;i < 10; ++i){//clear other boards
		row_tot[i] = 0;
		col_tot[i] = 0;
			for(var j = 0; j < 10; ++j){
				problem[i][j] = -1;
				answer[i][j] = -1;
				work[i][j] = -1;
				guess[i][j] = -1;
			}
		}
		draw_board();
		break;
		
		case 'Restart': //Restarts current problem
		solution_shown = false;
		creating_problem = false;
		solving = false;
		entering = false;
		//Display problem
		ctx.clearRect(10,10,550,550);
		ctx.rect(10,10,500.5,500.5);
		ctx.fill();
		for (var i = 0; i < 10; i++) { //Draw grid
			for(var j = 0; j < 10; j++){
				ctx.beginPath();
				ctx.fillStyle="#FFFFFF";
				ctx.rect(50*i + 11,50*j + 11,48.5,48.5);
			 	ctx.fill();
				ctx.closePath();
				ctx.fillStyle="#000000";
			}
		}
		for(var i = 0; i < 10; ++i){
			ctx.fillText(row_tot[i],525,50*i+50);
			ctx.fillText(col_tot[i],50*i + 25,540);
			for(var j = 0; j < 10; ++j){
				work[i][j] = problem[i][j];
				if(work[i][j] > 0){
					work[i][j] = 7;
				}
				decode_display(work[i][j],i,j);
			}
		}
		if(guessing){
			guessing = false;
			color_change('button3');
		}
		break;
		
		case 'Guess': //Allows user guessing mode
		if(!solution_shown && !entering && !solving){
			color_change('button3');
			if(guessing){
				guessing = false;
			}
			else{
				guessing = true;
			}
		}
		break;
	}
}

</script>

</body>
</html>
